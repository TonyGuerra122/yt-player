pkgname=yt-player
pkgver=1.2.0
pkgrel=1
pkgdesc="YT Player - um player simples para YouTube"
arch=('x86_64')
url="https://github.com/TonyGuerra122/yt-player"
license=('MIT')
depends=('java-runtime>=21')            # adicione 'java-openjfx' se usar JavaFX
makedepends=('maven' 'jdk-openjdk>=21' 'git' 'imagemagick')  # <— para gerar ícone
source=("git+$url.git#tag=v${pkgver}"
        "yt-player.desktop"
        "yt-player.launcher")
sha256sums=('SKIP' 'SKIP' 'SKIP')

build() {
  cd "$srcdir/yt-player"
  mvn -B -DskipTests package

  # Gerar PNG 256x a partir do ICO do projeto (ajuste o caminho se diferente)
  convert "src/main/resources/com/tonyguerra/ytplayer/favicon.ico[0]" \
          -resize 256x256 \
          "$srcdir/yt-player.png"
}

package() {
  install -d "$pkgdir/usr/share/java/$pkgname" \
             "$pkgdir/usr/bin" \
             "$pkgdir/usr/share/applications" \
             "$pkgdir/usr/share/icons/hicolor/256x256/apps"

  # JAR (ajuste o nome se necessário)
  install -m644 "$srcdir/yt-player/target/${pkgname}-${pkgver}.jar" \
    "$pkgdir/usr/share/java/$pkgname/${pkgname}-${pkgver}.jar"

  # Launcher com versão
  sed "s/@VERSION@/${pkgver}/g" "$srcdir/yt-player.launcher" > "$srcdir/yt-player.launcher.out"
  install -m755 "$srcdir/yt-player.launcher.out" "$pkgdir/usr/bin/yt-player"

  # Desktop + ícone gerado
  install -m644 "$srcdir/yt-player.desktop" \
    "$pkgdir/usr/share/applications/yt-player.desktop"
  install -m644 "$srcdir/yt-player.png" \
    "$pkgdir/usr/share/icons/hicolor/256x256/apps/yt-player.png"
}
